version: 2.6.1.{build}

branches:
  only:
    - develop
    - /release\/.*/

skip_tags: true
max_jobs: 1
image: Ubuntu1604
stack: jdk 8, python 3

build_script:
  - python3 -m pip install mkdocs mkdocs-material
  # Run NGB tests on H2
  - ./gradlew :server:catgenome:check
  # Run NGB tests on Postgres
  - ./gradlew clean :server:catgenome:test :server:catgenome:jacocoTestReport -Pdatabase=postgres
  # Publish coverage
  - bash <(curl -s https://codecov.io/bash)
  # Build everything with no tests
  - ./gradlew buildJar buildCli buildDoc buildDocker -PbuildNumber=${APPVEYOR_BUILD_NUMBER} -PnoTest
  - ./publish.sh
test: off
